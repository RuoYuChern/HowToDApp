# 智能合约

## 智能合约的逻辑

什么是智能合约？它们是存储在区块链上的计算机程序，让我们能够将传统合约转换成数字化合约。 智能合约完全符合逻辑 — 遵循 IFTTT （if this then that）逻辑结构。 它是开源的、可预测、被自动执行的程序代码。该代码被部署到以太坊上之后，在以太坊虚拟机的交易的上下文中，被执行（智能合约不能自动或者后台运行）。那么智能合约有什么特征呢：

1. 可执行的代码：智能合约只是计算机可执行代码，由高级的智能合约语言（Solidity）编译而来的，被编译成EVM（以太坊虚拟机）可执行的低级代码，类似java语言和JVM。
2. 法律意义：智能合约不具备法律意义，其最终执行是由去中心化的以太坊EVM在交易的上下文中，被执行调用。
3. 不变性：由于以太坊的去中心化，智能合约一旦被部署之后，不能再修改，修改智能合约的唯一方式发布新的智能合约实例，这里跟软件发布类似，如果老的版本有问题，必须发布新的版本。其中有些许差异：智能合约是无法下掉老版本的，但可以执行一个名为 SELFDESTRUCT（以前称为 SUICIDE）的 EVM 操作码来删除代码和内部状态，只留下一个空白账户。删除合约后发送到该帐户地址的任何交易都不会导致任何代码执行，因为那里不再有任何代码可执行。
4. 确定性：智能合约是IFTTT逻辑的可执行代码，除非是**编写BUG、被攻击**，不然在交易上下午中，其执行结果是确定的。
5. 不可抵赖性：EVM 在每个以太坊节点上作为本地实例运行，但由于 EVM 的所有实例都在相同的初始状态下运行并产生相同的最终状态，因此整个系统作为一个“世界计算机”运行。由于智能合约是分布式多节点执行，所以要具备幂等性、原子性，整个智能合约的幂等性、原子性由以太坊来保证。
6. 公开性：智能合约是部署在以太坊公链上，任何人都可以对合约条款进行审查，可以立即跟踪资产转移和其他相关信息。但公开性，不能说明不可违约。如果双方交易物都是以太坊上的物品，比如以太坊币和NFTs，那么确实是不可违约的。因为在交易之前可以审查去合约代码，确保条款是正确的，同时在审查代码是否有BUG，在条款和代码是正确的，按照合约的机制，在交易的上下文中，合约被EVM调用，而且这种调用是不受控制的，即整个以太坊系统在去中心化地调用。

智能合约可以理解为“承诺的程序化”，假如A与B进行交易，那如何确保A与B的交易不可违约呢？

| 交易方 | 传统方式                                     | 智能合约                           |
| --- | ---------------------------------------- | ------------------------------ |
| A   | 非赊账（一手交钱）                                | A通过EOA 向智能合约地址转账（数字货币）。        |
| B   | 履行承若，或者在法院等权威机构下履行承若。同时B也不能开空头支票（既要有现货）。 | EVM 调用履行合约的接口，进行现货履约（数字化的交付物）。 |

智能合约与传统合约履行，在违约方面其实没有本质的区别：

1. 双方都是现货交易，不能开空头支票（赊账）。
2. 背后都是需要第三方，现实中要么进行现货托管，智能合约其实是将承若的交付数字化，并由以太坊托管，所以在A通过EOA往智能合约地址转账时，由于该地址无法被B控制，是由合约本身控制（以太坊系统）的，只有在B履行交付之后，才转到B的EOA。这个跟现实世界的托管交易是类似的。
3. 如果B的交付物品不能被以太坊控制、托管。以太坊只是托管了该交付物品的通证(tokens)，由于智能合约不具备法律效应，其违约风险率反而高于传统的合约。

因此从这里我们可以总结出什么是智能合约：智能合约是一个具有地址（账户号）、余额、状态、代码的账户，称为合约账户。常规的用户账户（EOA）只有：地址、余额。常规用户账户是被用户控制，合约账户是被用户控制，因为用户掌握不了合约账户的私钥。合约账户是被合约本身拥有，最终**被以太坊EVM控制**。

智能合约可以很好解决数字化世界中的交易违约问题，但如果数字化交易物只是现实物品的一个token，那么智能合约反而没有传统合约那么有效。智能合约目前只是大家在数字化世界中，以太坊公链上的娱乐玩具。由于它的公开性、以及以太坊的公开性，智能合约很容易被攻击，有漏洞的智能合约很容易在瞬间犹豫攻击产生了致命的影响，有可能是巨大的损失。

所以，这里泼一下冷水：不要神化智能合约，智能合约目前只是以太坊上的娱乐工具，它替代不了什么。

现实世界的合约交易，合约的履行还是需要靠 交易机制（是否允许赊账、空头支票）、人品（诚信）、惩罚（强力机构介入），而这些机制数字化的难度和成本很高，尤其是数字化通证(token)与实物的兑换环节中还是有违约风险。&#x20;



## 智能合约语言



## 智能合约例子
